Sub SearchDatesAndInsertValues()
    Dim ws1 As Worksheet, ws2 As Worksheet
    Dim currentYear As Integer
    Dim searchDate As Date
    Dim i As Integer
    Dim insertRow As Long
    Dim targetValue As Variant
    
    ' シートの参照設定
    Set ws1 = ThisWorkbook.Sheets(1) ' Sheet(1)
    Set ws2 = ThisWorkbook.Sheets(2) ' Sheet(2)
    
    ' 現在の年を取得
    currentYear = Year(Date)
    
    ' 値を挿入する開始行（Sheet(1)のCells(2, 4)の位置を基準）
    insertRow = ws1.Cells(2, 4).Row
    
    ' Sheet(2)のCells(43, 3)からCells(43, 36)を検索
    For i = 3 To 36
        searchDate = ws2.Cells(43, i).Value ' 43行目のi列の値を取得
        
        ' 年が現在の年と同じかどうかを確認
        If Year(searchDate) = currentYear Then
            ' 年が一致する場合、同じ列の5行目の値を取得
            targetValue = ws2.Cells(5, i).Value
            
            ' Sheet(1)の挿入行にその値を入力
            ws1.Cells(insertRow, 4).Value = targetValue
            
            ' 次の行に値を挿入するため、挿入行を1つ下げる
            insertRow = insertRow + 1
        End If
    Next i
    
    MsgBox "該当する値の検索と挿入が完了しました。"
End Sub
Sub SearchStringsAndDisplayMismatch()

    Dim ws1 As Worksheet, ws2 As Worksheet
    Dim searchRange As Range, cell As Range
    Dim searchValue As String
    Dim foundCell As Range
    Dim msg As String
    Dim lastCol As Long
    Dim lastRow As Long

    ' シートを設定
    Set ws1 = ThisWorkbook.Sheets("Sheet1")
    Set ws2 = ThisWorkbook.Sheets("Sheet2")

    ' シート2の6行目の最終列を取得
    lastCol = ws2.Cells(6, ws2.Columns.Count).End(xlToLeft).Column

    ' シート1のD列5行目以降の範囲を設定
    lastRow = ws1.Cells(ws1.Rows.Count, "D").End(xlUp).Row
    Set searchRange = ws1.Range("D5:D" & lastRow)

    ' 一致しない文字列を格納するメッセージ用変数
    msg = ""

    ' シート2の6行目を順に検索
    For col = 3 To lastCol
        searchValue = ws2.Cells(6, col).Value

        ' シート1のD列で文字列を検索
        Set foundCell = searchRange.Find(What:=searchValue, LookIn:=xlValues, LookAt:=xlWhole)

        ' 一致しなかった場合、メッセージボックスに表示
        If foundCell Is Nothing Then
            msg = msg & searchValue & vbNewLine
        End If
    Next col

    ' 一致しなかった文字列を表示
    If msg <> "" Then
        MsgBox "一致しなかった文字列: " & vbNewLine & msg
    Else
        MsgBox "全ての文字列が一致しました。"
    End If

End Sub
Sub ImportCSVAndTransferSpecificData()
    Dim ws As Worksheet
    Dim csvWs As Worksheet
    Dim csvFilePath As String
    Dim csvData As Variant
    Dim i As Long
    Dim rowNum As Long
    Dim lastRow As Long
    
    ' CSVファイルのパスを指定
    csvFilePath = Application.GetOpenFilename("CSV Files (*.csv), *.csv", , "CSVファイルを選択")
    
    If csvFilePath = "False" Then
        MsgBox "CSVファイルが選択されませんでした。"
        Exit Sub
    End If
    
    ' CSVファイルを開く
    Workbooks.Open csvFilePath
    Set csvWs = ActiveSheet
    
    ' データの最終行を取得
    lastRow = csvWs.Cells(csvWs.Rows.Count, 1).End(xlUp).Row
    
    ' データを配列に読み込む
    csvData = csvWs.Range("A2:BR" & lastRow).Value ' 1行目は無視し、2行目から読み込む
    
    ' CSVファイルを閉じる
    Workbooks(csvWs.Parent.Name).Close False
    
    ' 調剤請求書（旭川市）のシートを指定
    Set ws = ThisWorkbook.Sheets("調剤請求書（旭川市）")
    
    ' 転記開始行は11行目
    rowNum = 11
    
    ' CSVデータをシートに転記
    For i = 1 To UBound(csvData, 1) ' 1行目（CSVの2行目）から読み込む
        If csvData(i, 1) <> "" Then ' 空でない行を処理
            ws.Cells(rowNum, 2).Value = csvData(i, 10) ' J列: 患者氏名
            ws.Cells(rowNum, 3).Value = csvData(i, 11) ' K列: 患者カナ氏名
            ws.Cells(rowNum, 4).Value = csvData(i, 12) ' L列: 生年月日
            ws.Cells(rowNum, 5).Value = csvData(i, 17) ' Q列: 公費
            ws.Cells(rowNum, 6).Value = csvData(i, 51) ' AY列: 生保受給者番号
            ws.Cells(rowNum, 7).Value = csvData(i, 38) ' AL列: 患者住所
            ws.Cells(rowNum, 8).Value = csvData(i, 34) ' AH列: 処方元の医療機関名
            ws.Cells(rowNum, 9).Value = csvData(i, 65) ' BM列: 処方元の医療機関コード
            rowNum = rowNum + 1
        End If
    Next i
    
    ' 完了メッセージ
    MsgBox "CSVデータの読み込みと転記が完了しました。", vbInformation
End Sub
